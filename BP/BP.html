<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Pressure Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base styles for status color coding */
        .status-normal { background-color: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .status-elevated { background-color: #fef3c7; color: #92400e; border-left: 4px solid #fbbf24; }
        .status-high { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #f87171; }
        
        /* Utility to make the table look better on mobile */
        @media (max-width: 640px) {
            .table-row > td:before {
                content: attr(data-label);
                float: left;
                font-weight: bold;
                text-transform: uppercase;
                margin-right: 8px;
            }
            .table-row {
                display: block;
                margin-bottom: 0.75rem; /* 12px */
                padding: 0.5rem; /* 8px */
                border-radius: 0.5rem; /* 8px */
            }
            .table-row > td {
                display: block;
                text-align: right !important;
                padding: 0.25rem 0; /* 4px */
                border-bottom: 1px solid #f3f4f6;
            }
            .table-row > td:last-child {
                border-bottom: none;
            }
            .table-header {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">ü©∫ Blood Pressure Tracker</h1>
        
        <div class="flex flex-wrap gap-4 items-center mb-6 bg-white p-4 rounded-lg shadow-md">
            <label for="date-filter" class="text-gray-700 font-medium">Filter by Date:</label>
            <input type="date" id="date-filter" onchange="filterData()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            <button onclick="resetFilter()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-150">
                Show All
            </button>
        </div>

        <div id="summary-dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            </div>

        <div class="bg-white rounded-lg shadow-xl overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 table-header">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SYS (Systolic)</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DIA (Diastolic)</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PULSE</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                </thead>
                <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
        
        </div>

    <script>
        // 1. DATA INJECTION
        const rawData = `
Date|Time|SYS|DIA|PULSE
2025.10.24|18:50|166|105|82
2025.10.24|20:40|140|76|71
2025.10.25|11:00|136|87|76
2025.10.25|15:00|123|80|65
2025.10.26|11:50|152|86|76
2025.10.26|19:00|130|84|73
2025.10.27|13:00|148|93|70
2025.10.28|13:20|106|73|71
2025.11.15|17:00|123|81|77
2025.11.16|08:34|123|84|77
2025.11.17|16:52|112|76|85
2025.11.18|18:24|117|76|79
2025.11.19|17.32|135|85|77
2025.11.20|18:19|129|79|72
2025.11.21|17:22|116|77|76
2025.11.22|16:49|110|70|84
2025.11.23|10:27|118|82|89
2025.11.23|18:15|123|85|82
2025.11.24|17:58|123|82|89
2025.11.25|16:55|118|82|84 
        `.trim();

        // 2. DATA PROCESSING
        function processData(dataString) {
            const lines = dataString.split('\n');
            const [headerLine, ...dataLines] = lines;
            const headers = headerLine.split('|').map(h => h.trim());

            return dataLines.map(line => {
                const values = line.split('|').map(v => v.trim());
                const record = {};
                headers.forEach((header, index) => {
                    record[header] = values[index];
                });

                // Clean up date and time formats for consistency and filtering
                record.Date = record.Date.replace(/\./g, '-');
                record.Time = record.Time.replace(/\./g, ':');
                
                // Convert numerical values to actual numbers
                record.SYS = parseInt(record.SYS, 10);
                record.DIA = parseInt(record.DIA, 10);
                record.PULSE = parseInt(record.PULSE, 10);

                // Add Status property
                record.Status = getBPStatus(record.SYS, record.DIA);
                return record;
            });
        }

        const allData = processData(rawData);
        let filteredData = [...allData];

        // 3. CORE LOGIC: COLOR CODING (Eg√©szs√©g√ºgyi Sz√≠nk√≥dol√°s)
        function getBPStatus(sys, dia) {
            // Using standard guidelines (e.g., ACC/AHA 2017)
            if (sys < 120 && dia < 80) {
                return { label: 'Normal', class: 'status-normal' };
            } else if ((sys >= 120 && sys < 130) && dia < 80) {
                return { label: 'Elevated', class: 'status-elevated' };
            } else if ((sys >= 130 && sys < 140) || (dia >= 80 && dia < 90)) {
                return { label: 'High (Stage 1)', class: 'status-high' };
            } else if (sys >= 140 || dia >= 90) {
                 return { label: 'High (Stage 2)', class: 'status-high' };
            } else {
                return { label: 'Unknown', class: 'bg-gray-100' };
            }
        }

        // 4. RENDERING FUNCTIONS
        
        // Render the main data table
        function renderTable(data) {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = ''; // Clear previous data

            data.forEach(record => {
                const row = document.createElement('tr');
                row.className = `table-row ${record.Status.class} transition duration-150 hover:shadow-lg`;
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" data-label="Date:">${record.Date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" data-label="Time:">${record.Time}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold" data-label="SYS:">${record.SYS}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold" data-label="DIA:">${record.DIA}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" data-label="Pulse:">${record.PULSE}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold" data-label="Status:">
                        <span class="px-2 inline-flex text-xs leading-5 rounded-full capitalize" style="background-color: inherit; color: inherit;">
                            ${record.Status.label}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Render the summary dashboard (√ñsszegz≈ë Statisztik√°k)
        function renderSummary(data) {
            const dashboard = document.getElementById('summary-dashboard');
            dashboard.innerHTML = '';
            
            if (data.length === 0) {
                dashboard.innerHTML = '<div class="col-span-4 text-center p-4 bg-yellow-100 text-yellow-700 rounded-lg">No data matches the current filter.</div>';
                return;
            }

            const totalSYS = data.reduce((sum, r) => sum + r.SYS, 0);
            const totalDIA = data.reduce((sum, r) => sum + r.DIA, 0);
            const totalPULSE = data.reduce((sum, r) => sum + r.PULSE, 0);
            const count = data.length;

            const avgSYS = (totalSYS / count).toFixed(1);
            const avgDIA = (totalDIA / count).toFixed(1);
            const avgPULSE = (totalPULSE / count).toFixed(1);

            const avgStatus = getBPStatus(Math.round(avgSYS), Math.round(avgDIA));

            const summaryItems = [
                { title: 'Average SYS', value: avgSYS, unit: 'mmHg', class: avgStatus.class },
                { title: 'Average DIA', value: avgDIA, unit: 'mmHg', class: avgStatus.class },
                { title: 'Average Pulse', value: avgPULSE, unit: 'BPM', class: 'bg-white shadow-md' },
                { title: 'Total Readings', value: count, unit: 'Count', class: 'bg-white shadow-md' }
            ];

            summaryItems.forEach(item => {
                dashboard.innerHTML += `
                    <div class="${item.class} p-5 rounded-xl transition duration-300 transform hover:scale-105 border-b-4 border-l-4 border-opacity-70">
                        <div class="text-sm font-medium text-gray-500">${item.title}</div>
                        <div class="mt-1 text-3xl font-extrabold text-gray-900">
                            ${item.value} <span class="text-base font-semibold text-gray-500">${item.unit}</span>
                        </div>
                    </div>
                `;
            });
        }

        // 5. FILTERING (D√°tum Sz≈±r√©s)
        function filterData() {
            const dateFilter = document.getElementById('date-filter').value;
            
            if (!dateFilter) {
                filteredData = [...allData];
            } else {
                // The date format in data is YYYY-MM-DD
                const formattedFilterDate = dateFilter.replace(/\//g, '-'); 
                
                filteredData = allData.filter(record => {
                    return record.Date === formattedFilterDate;
                });
            }
            
            // Re-render
            renderSummary(filteredData);
            renderTable(filteredData);
        }

        function resetFilter() {
            document.getElementById('date-filter').value = '';
            filterData();
        }

        // 6. INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            // Set max date for filter to the latest date in the data
            const latestDate = allData.reduce((latest, record) => {
                return record.Date > latest ? record.Date : latest;
            }, allData[0].Date);
            document.getElementById('date-filter').setAttribute('max', latestDate);

            renderSummary(allData);
            renderTable(allData);
        });

    </script>
</body>
</html>