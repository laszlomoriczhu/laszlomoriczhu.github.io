<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√©rnyom√°s Nyilv√°ntart√≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        .status-normal { background-color: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .status-elevated { background-color: #fef3c7; color: #92400e; border-left: 4px solid #fbbf24; }
        .status-high-1 { background-color: #fed7aa; color: #9a3412; border-left: 4px solid #fb923c; }
        .status-high-2 { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #f87171; }
        .status-high-3 { background-color: #fecaca; color: #7f1d1d; border-left: 4px solid #dc2626; }
        .status-optimal { background-color: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
        
        @media (max-width: 640px) {
            .table-row > td:before {
                content: attr(data-label);
                float: left;
                font-weight: bold;
                font-size: 0.75rem;
                text-transform: uppercase;
                margin-right: 8px;
                color: #6b7280;
            }
            .table-row {
                display: block;
                margin-bottom: 1rem;
                padding: 0.75rem;
                border-radius: 0.5rem;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .table-row > td {
                display: block;
                text-align: right !important;
                padding: 0.5rem 0;
                border-bottom: 1px solid #f3f4f6;
                font-size: 0.875rem;
            }
            .table-row > td:last-child {
                border-bottom: none;
                padding-top: 0.75rem;
            }
            .table-header {
                display: none;
            }
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
        .tab-button:not(.active) {
            background-color: #e5e7eb;
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-2 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-4 sm:mb-6 border-b pb-2">ü©∫ V√©rnyom√°s Nyilv√°ntart√≥</h1>
        
        <!-- Szabv√°ny v√°laszt√≥ -->
        <div class="bg-white p-3 sm:p-4 rounded-lg shadow-md mb-4">
            <label for="standard-select" class="block text-sm font-medium text-gray-700 mb-2">√ârt√©kel√©si szabv√°ny:</label>
            <select id="standard-select" onchange="changeStandard()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
                <option value="acc">USA (ACC/AHA 2017) - Szigor√∫bb</option>
                <option value="esc" selected>EU (ESC/ESH 2018) - Eur√≥pai</option>
                <option value="who">WHO - Egyszer≈±s√≠tett</option>
            </select>
            <div id="standard-info" class="mt-3 p-3 bg-blue-50 rounded text-xs sm:text-sm text-gray-700"></div>
        </div>

        <!-- Sz≈±r≈ëk -->
        <div class="bg-white p-3 sm:p-4 rounded-lg shadow-md mb-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div>
                    <label for="date-from" class="block text-sm font-medium text-gray-700 mb-1">Id≈ëszak kezdete:</label>
                    <input type="date" id="date-from" onchange="filterData()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
                <div>
                    <label for="date-to" class="block text-sm font-medium text-gray-700 mb-1">Id≈ëszak v√©ge:</label>
                    <input type="date" id="date-to" onchange="filterData()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
            </div>
            <button onclick="resetFilter()" class="mt-3 w-full sm:w-auto bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-150 text-sm">
                √ñsszes megjelen√≠t√©se
            </button>
        </div>

        <!-- Tab v√°lt√≥ -->
        <div class="flex gap-2 mb-4 overflow-x-auto">
            <button onclick="showTab('table')" id="tab-table" class="tab-button active">üìä T√°bl√°zat</button>
            <button onclick="showTab('chart')" id="tab-chart" class="tab-button">üìà Diagram</button>
        </div>

        <!-- Statisztik√°k -->
        <div id="summary-dashboard" class="grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 mb-4"></div>

        <!-- T√°bl√°zat n√©zet -->
        <div id="table-view" class="bg-white rounded-lg shadow-xl overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 table-header">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">D√°tum</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Id≈ë</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">SYS</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">DIA</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pulzus</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">St√°tusz</th>
                    </tr>
                </thead>
                <tbody id="data-table-body" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
        </div>

        <!-- Diagram n√©zet -->
        <div id="chart-view" class="bg-white rounded-lg shadow-xl p-3 sm:p-6" style="display: none;">
            <canvas id="bp-chart"></canvas>
        </div>
    </div>

    <script>
        const rawData = `
Date|Time|SYS|DIA|PULSE
2025.10.24|18:50|166|105|82
2025.10.24|20:40|140|76|71
2025.10.25|11:00|136|87|76
2025.10.25|15:00|123|80|65
2025.10.26|11:50|152|86|76
2025.10.26|19:00|130|84|73
2025.10.27|13:00|148|93|70
2025.10.28|13:20|106|73|71
2025.11.03|19:27|120|77|67
2025.11.15|17:00|123|81|77
2025.11.16|08:34|123|84|77
2025.11.17|16:52|112|76|85
2025.11.18|18:24|117|76|79
2025.11.19|17.32|135|85|77
2025.11.20|18:19|129|79|72
2025.11.21|17:22|116|77|76
2025.11.22|16:49|110|70|84
2025.11.23|10:27|118|82|89
2025.11.23|18:15|123|85|82
2025.11.24|17:58|123|82|89
2025.11.25|16:55|118|82|84
2025.11.26|20:06|115|75|81
2025.11.27|17:04|114|79|82
2025.11.28|18:15|116|80|82
2025.11.29|11:06|122|83|83
2025.11.30|18:58|122|82|81
2025.12.01|17:48|113|71|77
2025.12.02|18:12|109|74|78
2025.12.03|17:48|119|81|81
2025.12.04|18:15|106|78|81
2025.12.05|06:25|116|80|76
2025.12.05|17:19|118|76|72
2025.12.06|16:30|111|74|86
2025.12.07|19:58|118|78|71
2025.12.08|17:50|112|71|76
2025.12.09|17:32|110|77|82
2025.12.10|17:40|107|71|73
2025.12.11|18:26|116|75|76
2025.12.12|19:50|115|75|72
2025.12.13|17:41|108|70|74
2025.12.14|12:03|117|76|76
2025.12.14|18:45|121|76|73
2025.12.15|17:40|128|90|82
2025.12.16|16:56|114|74|81
        `.trim();

        let currentStandard = 'esc';
        let chartInstance = null;

        const standards = {
            acc: {
                name: 'USA (ACC/AHA 2017)',
                description: 'Szigor√∫bb amerikai szabv√°ny. A 130/80 m√°r magas v√©rnyom√°snak sz√°m√≠t.',
                link: 'https://www.ahajournals.org/doi/10.1161/HYP.0000000000000065',
                categories: [
                    { label: 'Norm√°lis', class: 'status-normal', check: (s, d) => s < 120 && d < 80 },
                    { label: 'Emelkedett', class: 'status-elevated', check: (s, d) => (s >= 120 && s < 130) && d < 80 },
                    { label: 'Magas (1. st√°dium)', class: 'status-high-1', check: (s, d) => (s >= 130 && s < 140) || (d >= 80 && d < 90) },
                    { label: 'Magas (2. st√°dium)', class: 'status-high-2', check: (s, d) => s >= 140 || d >= 90 }
                ]
            },
            esc: {
                name: 'EU (ESC/ESH 2018)',
                description: 'Eur√≥pai szabv√°ny. R√©szletesebb kateg√≥ri√°kkal, enyh√©bb hat√°r√©rt√©kekkel.',
                link: 'https://academic.oup.com/eurheartj/article/39/33/3021/5079119',
                categories: [
                    { label: 'Optim√°lis', class: 'status-optimal', check: (s, d) => s < 120 && d < 80 },
                    { label: 'Norm√°lis', class: 'status-normal', check: (s, d) => (s >= 120 && s < 130) || (d >= 80 && d < 85) },
                    { label: 'Magas norm√°lis', class: 'status-elevated', check: (s, d) => (s >= 130 && s < 140) || (d >= 85 && d < 90) },
                    { label: 'Hypertonia 1.', class: 'status-high-1', check: (s, d) => (s >= 140 && s < 160) || (d >= 90 && d < 100) },
                    { label: 'Hypertonia 2.', class: 'status-high-2', check: (s, d) => (s >= 160 && s < 180) || (d >= 100 && d < 110) },
                    { label: 'Hypertonia 3.', class: 'status-high-3', check: (s, d) => s >= 180 || d >= 110 }
                ]
            },
            who: {
                name: 'WHO',
                description: 'Vil√°geg√©szs√©g√ºgyi Szervezet egyszer≈±s√≠tett kateg√≥ri√°i.',
                link: 'https://www.who.int/news-room/fact-sheets/detail/hypertension',
                categories: [
                    { label: 'Norm√°lis', class: 'status-normal', check: (s, d) => s < 140 && d < 90 },
                    { label: 'Magas v√©rnyom√°s', class: 'status-high-2', check: (s, d) => s >= 140 || d >= 90 }
                ]
            }
        };

        function processData(dataString) {
            const lines = dataString.split('\n');
            const [headerLine, ...dataLines] = lines;
            
            return dataLines.map(line => {
                const values = line.split('|').map(v => v.trim());
                const record = {
                    Date: values[0].replace(/\./g, '-'),
                    Time: values[1].replace(/\./g, ':'),
                    SYS: parseInt(values[2], 10),
                    DIA: parseInt(values[3], 10),
                    PULSE: parseInt(values[4], 10)
                };
                record.Status = getBPStatus(record.SYS, record.DIA);
                return record;
            });
        }

        const allData = processData(rawData);
        let filteredData = [...allData];

        function getBPStatus(sys, dia) {
            const standard = standards[currentStandard];
            for (let cat of standard.categories) {
                if (cat.check(sys, dia)) {
                    return { label: cat.label, class: cat.class };
                }
            }
            return { label: 'Ismeretlen', class: 'bg-gray-100' };
        }

        function changeStandard() {
            currentStandard = document.getElementById('standard-select').value;
            const standard = standards[currentStandard];
            document.getElementById('standard-info').innerHTML = `
                <strong>${standard.name}:</strong> ${standard.description}
                <a href="${standard.link}" target="_blank" class="text-blue-600 hover:text-blue-800 underline ml-2">
                    R√©szletek ‚Üí
                </a>
            `;
            
            filteredData = filteredData.map(record => ({
                ...record,
                Status: getBPStatus(record.SYS, record.DIA)
            }));
            
            renderSummary(filteredData);
            renderTable(filteredData);
            if (chartInstance) {
                renderChart(filteredData);
            }
        }

        function renderTable(data) {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';

            data.forEach(record => {
                const row = document.createElement('tr');
                row.className = `table-row ${record.Status.class} transition duration-150 hover:shadow-lg`;
                
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900" data-label="D√°tum:">${record.Date}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600" data-label="Id≈ë:">${record.Time}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-bold" data-label="SYS:">${record.SYS}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-bold" data-label="DIA:">${record.DIA}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600" data-label="Pulzus:">${record.PULSE}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-semibold" data-label="St√°tusz:">${record.Status.label}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function renderSummary(data) {
            const dashboard = document.getElementById('summary-dashboard');
            dashboard.innerHTML = '';
            
            if (data.length === 0) {
                dashboard.innerHTML = '<div class="col-span-4 text-center p-4 bg-yellow-100 text-yellow-700 rounded-lg text-sm">Nincs adat a kiv√°lasztott id≈ëszakra.</div>';
                return;
            }

            const avgSYS = (data.reduce((sum, r) => sum + r.SYS, 0) / data.length).toFixed(1);
            const avgDIA = (data.reduce((sum, r) => sum + r.DIA, 0) / data.length).toFixed(1);
            const avgPULSE = (data.reduce((sum, r) => sum + r.PULSE, 0) / data.length).toFixed(1);
            const avgStatus = getBPStatus(Math.round(avgSYS), Math.round(avgDIA));

            const summaryItems = [
                { title: '√Åtlag SYS', value: avgSYS, unit: 'Hgmm', class: avgStatus.class },
                { title: '√Åtlag DIA', value: avgDIA, unit: 'Hgmm', class: avgStatus.class },
                { title: '√Åtlag pulzus', value: avgPULSE, unit: 'BPM', class: 'bg-white shadow-md' },
                { title: 'M√©r√©sek', value: data.length, unit: 'db', class: 'bg-white shadow-md' }
            ];

            summaryItems.forEach(item => {
                dashboard.innerHTML += `
                    <div class="${item.class} p-3 sm:p-5 rounded-xl transition duration-300 transform hover:scale-105 border-b-4 border-l-4 border-opacity-70">
                        <div class="text-xs sm:text-sm font-medium text-gray-500">${item.title}</div>
                        <div class="mt-1 text-xl sm:text-3xl font-extrabold text-gray-900">
                            ${item.value} <span class="text-sm sm:text-base font-semibold text-gray-500">${item.unit}</span>
                        </div>
                    </div>
                `;
            });
        }

        function renderChart(data) {
            const ctx = document.getElementById('bp-chart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            const labels = data.map(r => `${r.Date} ${r.Time}`);
            const sysData = data.map(r => r.SYS);
            const diaData = data.map(r => r.DIA);
            const pulseData = data.map(r => r.PULSE);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'SYS (Szisztol√©s)',
                            data: sysData,
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'DIA (Diasztol√©s)',
                            data: diaData,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Pulzus',
                            data: pulseData,
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'V√©rnyom√°s √©s pulzus alakul√°sa',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '√ârt√©kek'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        }
                    }
                }
            });
        }

        function filterData() {
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;
            
            filteredData = allData.filter(record => {
                if (dateFrom && record.Date < dateFrom) return false;
                if (dateTo && record.Date > dateTo) return false;
                return true;
            });
            
            renderSummary(filteredData);
            renderTable(filteredData);
            if (chartInstance) {
                renderChart(filteredData);
            }
        }

        function resetFilter() {
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            filteredData = [...allData];
            renderSummary(filteredData);
            renderTable(filteredData);
            if (chartInstance) {
                renderChart(filteredData);
            }
        }

        function showTab(tab) {
            document.getElementById('tab-table').classList.remove('active');
            document.getElementById('tab-chart').classList.remove('active');
            
            if (tab === 'table') {
                document.getElementById('table-view').style.display = 'block';
                document.getElementById('chart-view').style.display = 'none';
                document.getElementById('tab-table').classList.add('active');
            } else {
                document.getElementById('table-view').style.display = 'none';
                document.getElementById('chart-view').style.display = 'block';
                document.getElementById('tab-chart').classList.add('active');
                renderChart(filteredData);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const minDate = allData[0].Date;
            const maxDate = allData[allData.length - 1].Date;
            document.getElementById('date-from').setAttribute('min', minDate);
            document.getElementById('date-from').setAttribute('max', maxDate);
            document.getElementById('date-to').setAttribute('min', minDate);
            document.getElementById('date-to').setAttribute('max', maxDate);
            
            changeStandard();
            renderSummary(allData);
            renderTable(allData);
        });
    </script>
</body>
</html>